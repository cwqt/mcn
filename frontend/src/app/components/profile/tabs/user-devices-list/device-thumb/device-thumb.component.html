<app-thumb-wrapper
    [mini]="mini"
    [recordable]="device"
    [type]="'device'"
    [currentUser]="currentUser"
    [authorUser]="authorUser">
    <div class="title">
        <h2>{{device.name}}</h2>

        <div class="state-indicator" id={{device.state}}>
            <mat-icon inline>{{deviceState.icon}}</mat-icon>
            <span>{{deviceState.text}}</span>
        </div>
    </div>

    <div class="subheading">
        <p>@{{device.network_name}}:<b>{{device.hardware_model}}</b></p>
        <ibm-tag type="blue">Jade plant</ibm-tag>
    </div>

    <br />

    <mat-accordion class="object-meta">
        <app-loadable-panel
            [loading]="cache.device.loading"
            [title]="'Device information'"
            [description]="cache.device.error"
            [hasData]="cache.device.data != undefined"
            (onClick)="getDeviceMeta()">
            <div *ngIf="cache.device.data && !cache.device.error">
                <p><b>Device id:</b>{{cache.device.data._id || '—'}}</p>
                <p><b>Api key id:</b>{{cache.device.data.api_key?._id || '—'}}</p>
                <p><b>Assigned to:</b>{{cache.device.data.assigned_to?.type || 'none'}}: {{cache.device.data.assigned_to?.name || 'not assigned to any recordable'}}</p>
                <p><b>Last ping: </b>{{cache.device.data.last_ping | amTimeAgo}} </p>
                <p><b>Created:</b>{{(cache.device.data.created_at | amTimeAgo) || '—'}}</p>
                <p><b>Software version:</b>{{cache.device.data.software_version || '—'}}</p>
                <p><b>Hardware model:</b>{{deviceInfo.model_name || '—'}}</p>
                <p><b>Total data points:</b>{{cache.device.data.measurement_count || 0}}</p>
            </div>
        </app-loadable-panel>

        <app-loadable-panel
            [loading]="cache.latest_data.loading"
            [title]="'Latest data'"
            [description]="cache.latest_data.error ? cache.latest_data.error : ( device.last_ping ? (device.last_ping | amTimeAgo) : '')"
            [hasData]="cache.latest_data.data != undefined"
            (onClick)="getLatestData()">

            <h1>hello</h1>

            <div *ngIf="cache.latest_data.data && !cache.latest_data.error">
                <p *ngFor="let field of cache.latest_data.data.data | keyvalue">
                    <b>{{field.key}}:</b> {{field.value}} {{deviceInfo}}
                </p>
            </div>

            <mat-action-row>
                <app-load-button
                    [loading]="cache.latest_data.loading"
                    [raised]="false"
                    [icon]="'leak_add'">
                    Request new data
                </app-load-button>
            </mat-action-row>
        </app-loadable-panel>

      </mat-accordion>

</app-thumb-wrapper>
