<div *ngIf="sourceGraph && recordableGraph && flatGraphList">
  <div class="counter">
    <span>Search for</span>
    <app-data-counter #counter [sources]="sourceGraph" [recordables]="recordableGraph">
    </app-data-counter>
    <ui-button class="request-adder" variant="primary" [disabled]="!counter.hasValidData && !counter.loading" (click)="addRequest()">
      <ui-icon>add</ui-icon>
    </ui-button>
  </div>

  <div class="aggregate-chart-settings">
    <mat-button-toggle-group value="bar">
      <mat-button-toggle
        *ngFor="let chart of chartType | keyvalue"
        [value]="chart.key">
        <ui-icon>{{ chart.value }}</ui-icon>
        <span>{{ chart.key | titlecase }}</span>
      </mat-button-toggle>
    </mat-button-toggle-group>  
  </div>

  <div class="aggregate-wrapper">
    <div class="aggregate-chart-preview">
      <app-data-chart #chart [aggregationRequest]="aggregationRequest">
      </app-data-chart>
    </div>

    <div class="aggregate-requests">
      <div *ngFor="let req of aggregationRequests" class="point" [class.editing]="req.editing">
        <div class="point-header">
          <div class="point-info">
            <div class="color-picker" [style]="'background-color: ' + (colorMap[req.color]['200'] || colorMap[0]['200'] )">
              <ui-icon>{{ measurementInfo[req.measurement].icon}}</ui-icon>
            </div>
    
            <p>
              <b>{{ measurementInfo[req.measurement].title }}</b>&nbsp;on&nbsp;<b>{{ flatGraphList[req.recordable.split('-')[1]].name }}</b>&nbsp;from&nbsp;<span
                *ngFor="let s of req.sources"><b>{{ flatGraphList[s.split('-')[1]].name }}</b></span>&nbsp;in&nbsp;{{ dataFormatInfo[req.data_format].title }}
              ({{ dataFormatInfo[req.data_format].symbol }})
            </p>
          </div>
    
          <div class="point-header-buttons">
            <ui-icon-button variant="warn" (click)="deleteRequest(req)">delete</ui-icon-button>
          </div>
        </div>
      </div>    
    </div>
  </div>
</div>
